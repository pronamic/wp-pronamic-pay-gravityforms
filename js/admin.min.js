!function(d){function t(n){var a=this,o=d(n),r={};r.feed=o.find("#gf_ideal_feed"),r.gravityForm=o.find("#gf_ideal_gravity_form"),r.formId=o.find("#_pronamic_pay_gf_form_id"),r.configId=o.find("#gf_ideal_config_id"),r.delayPostCreationItem=o.find("#gf_ideal_delay_post_creation_item"),r.confirmationSelectFields=o.find(".gf_ideal_confirmation_select"),r.userRoleFieldId=o.find("#gf_ideal_user_role_field_id"),r.delayNotifications=o.find("#gf_ideal_delay_notifications"),r.fieldSelectFields=o.find("select.field-select"),r.subscriptionAmountType=o.find('input[name="_pronamic_pay_gf_subscription_amount_type"]'),r.subscriptionAmountField=o.find("#pronamic_pay_gf_subscription_amount_field"),r.subscriptionIntervalType=o.find('input[name="_pronamic_pay_gf_subscription_interval_type"]'),r.subscriptionInterval=o.find("#pronamic_pay_gf_subscription_interval"),r.subscriptionIntervalPeriod=o.find("#pronamic_pay_gf_subscription_interval_period"),r.subscriptionIntervalDateType=o.find('input[name="_pronamic_pay_gf_subscription_interval_date_type"]'),r.subscriptionIntervalDate=o.find("#pronamic_pay_gf_subscription_interval_date"),r.subscriptionIntervalDateDay=o.find("#pronamic_pay_gf_subscription_interval_date_day"),r.subscriptionIntervalDateMonth=o.find("#pronamic_pay_gf_subscription_interval_date_month"),r.subscriptionIntervalField=o.find("#pronamic_pay_gf_subscription_interval_field"),r.subscriptionFrequencyType=o.find('input[name="_pronamic_pay_gf_subscription_frequency_type"]'),r.subscriptionNumberPeriods=o.find("#pronamic_pay_gf_subscription_number_periods"),r.subscriptionFrequencyField=o.find("#pronamic_pay_gf_subscription_frequency_field");var s=JSON.parse(r.feed.val()),p=JSON.parse(r.gravityForm.val());this.updateDelayPostCreationItem=function(){var e=!1;p&&0<a.getFieldsByType(["post_title","post_content","post_excerpt","post_category","post_custom_field","post_image","post_tag"]).length&&(e=!0),r.delayPostCreationItem.toggle(e)},this.updateConfirmationFields=function(){r.confirmationSelectFields.empty(),d("<option>").appendTo(r.confirmationSelectFields),p&&d.each(r.confirmationSelectFields,function(e,n){var a=d(n).attr("data-pronamic-link-name");d.each(p.confirmations,function(e,i){var t=!1;"object"==typeof s.links&&(t=!1,"object"==typeof s.links[a]&&(t=s.links[a].confirmation_id===i.id),d("<option>").attr("value",i.id).text(i.name).prop("selected",t).appendTo(n))})})},this.getFieldsByType=function(e){var i=[];if(p)for(var t=0;t<p.fields.length;t++)0<=d.inArray(p.fields[t].type,e)&&i.push(p.fields[t]);return i},this.getInputs=function(){var t=[];return p&&d.each(p.fields,function(e,i){i.inputs?d.each(i.inputs,function(e,i){t.push(i)}):i.displayOnly||t.push(i)}),t},this.changeForm=function(){jQuery.get(ajaxurl,{action:"gf_get_form_data",formId:r.formId.val()},function(e){e.success&&(p=e.data,a.updateFields())})},this.updateUserRoleFields=function(){r.userRoleFieldId.empty(),d("<option>").appendTo(r.userRoleFieldId),p&&d.each(p.fields,function(e,i){var t=i.adminLabel||i.label;d("<option>").attr("value",i.id).text(t).prop("selected",s.userRoleFieldId==i.id).appendTo(r.userRoleFieldId)})},this.updateConfigFields=function(){var e=r.configId.find("option:selected").attr("data-ideal-method");o.find(".extra-settings").hide(),o.find(".method-"+e).show()},this.updateNotifications=function(){r.delayNotifications.empty(),p&&d.each(p.notifications,function(e,i){var t,n;"form_submission"===i.event&&(t=d("<li>").appendTo(r.delayNotifications),n="pronamic-pay-gf-notification-"+i.id,d('<input type="checkbox" name="_pronamic_pay_gf_delay_notification_ids[]">').attr("id",n).val(i.id).prop("checked",0<=d.inArray(i.id,s.delayNotificationIds)).appendTo(t),t.append(" "),d("<label>").attr("for",n).text(i.name).appendTo(t))})},this.updateSubscriptionFields=function(){var t;p&&(r.subscriptionAmountField.empty(),r.subscriptionIntervalField.empty(),r.subscriptionFrequencyField.empty(),t=[],p&&d.each(p.fields,function(e,i){"product"===i.type&&t.push(i)}),o=d(r.subscriptionAmountField),d("<option>").appendTo(o),d.each(t,function(e,i){var t=i.adminLabel||i.label;d("<option>").attr("value",i.id).text(t).prop("selected",s.subscriptionAmountField==i.id).appendTo(o)}),r.subscriptionAmountType.on("change",function(){var e,i=r.subscriptionAmountType.filter(":checked").val();d(n).find(".pronamic-pay-gf-subscription-amount-settings").hide(),""===i?r.subscriptionAmountType.parents("tr").siblings().hide():(r.subscriptionAmountType.parents("tr").siblings().show(),(e=r.subscriptionAmountType.parents("table").find("tr")).removeClass("even"),e.filter(":visible:even").addClass("even"));i=d(n).find(".pronamic-pay-gf-subscription-amount-settings.amount-"+i);0<i.length&&i.show()}),r.subscriptionAmountType.trigger("change"),o=d(r.subscriptionIntervalField),d("<option>").appendTo(o),d.each(a.getInputs(),function(e,i){var t=i.adminLabel||i.label;d("<option>").attr("value",i.id).text(t).prop("selected",s.subscriptionIntervalField==i.id).appendTo(o)}),r.subscriptionIntervalType.on("change",function(){var e=r.subscriptionIntervalType.filter(":checked").val();d(n).find(".pronamic-pay-gf-subscription-interval-settings").hide();var i=d(n).find(".pronamic-pay-gf-subscription-interval-settings.interval-"+e);"fixed"!==e&&(r.subscriptionIntervalPeriod.val("D"),r.subscriptionIntervalPeriod.trigger("change")),0<i.length&&i.show()}),r.subscriptionIntervalDateType.on("change",function(){var e=r.subscriptionIntervalDateType.filter(":checked").val();d(n).find(".pronamic-pay-gf-subscription-interval-date-settings").hide();e=d(n).find(".pronamic-pay-gf-subscription-interval-date-settings.interval-date-"+e);0<e.length&&e.show()}),r.subscriptionIntervalPeriod.on("change",function(){var e=r.subscriptionIntervalPeriod.val();switch(d(n).find(".pronamic-pay-gf-subscription-interval-date-sync-settings").hide(),d(n).find(".pronamic-pay-gf-subscription-interval-date-sync-settings.interval-"+e).show(),e){case"D":r.subscriptionIntervalDateType.filter('[value="payment_date"]').prop("checked",!0),r.subscriptionIntervalDateType.attr("disabled","disabled"),r.subscriptionIntervalDate.val(""),r.subscriptionIntervalDateDay.val(""),r.subscriptionIntervalDateMonth.val("");break;case"W":r.subscriptionIntervalDateType.removeAttr("disabled"),r.subscriptionIntervalDate.val(""),r.subscriptionIntervalDateMonth.val("");break;case"M":r.subscriptionIntervalDateType.removeAttr("disabled"),r.subscriptionIntervalDateDay.val(""),r.subscriptionIntervalDateMonth.val("");break;case"Y":r.subscriptionIntervalDateType.removeAttr("disabled"),r.subscriptionIntervalDateDay.val("")}r.subscriptionIntervalDateType.trigger("change")}),d(n).find("select.pronamic-pay-gf-subscription-interval-date-sync-settings").on("change",function(){r.subscriptionIntervalDateType.filter('[value="sync"]').prop("checked",!0),r.subscriptionIntervalDateType.trigger("change")}),r.subscriptionIntervalType.trigger("change"),r.subscriptionIntervalPeriod.trigger("change"),o=d(r.subscriptionFrequencyField),d("<option>").appendTo(o),d.each(a.getInputs(),function(e,i){var t=i.adminLabel||i.label;d("<option>").attr("value",i.id).text(t).prop("selected",s.subscriptionFrequencyField==i.id).appendTo(o)}),r.subscriptionFrequencyType.on("change",function(){var e=r.subscriptionFrequencyType.filter(":checked").val();d(n).find(".pronamic-pay-gf-subscription-frequency-settings").hide();e=d(n).find(".pronamic-pay-gf-subscription-frequency-settings.frequency-"+e);0<e.length&&e.show()}),r.subscriptionFrequencyType.trigger("change"))},this.updateSelectFields=function(){p&&(r.fieldSelectFields.empty(),r.fieldSelectFields.each(function(e,i){var n=(o=d(i)).data("gateway-field-name"),i=o.data("auto-option-label");""!==i&&d("<option>").attr("value","auto").text(i).prop("selected","auto"==s.fields[n]).appendTo(o),d("<option>").appendTo(o),d.each(a.getInputs(),function(e,i){var t=i.adminLabel||i.label;d("<option>").attr("value",i.id).text(t).prop("selected",s.fields[n]==i.id).appendTo(o)})}))},this.updateFields=function(){a.updateConfigFields(),a.updateDelayPostCreationItem(),a.updateConfirmationFields(),a.updateUserRoleFields(),a.updateSubscriptionFields(),a.updateSelectFields(),a.updateNotifications()},a.updateFields(),r.formId.change(a.changeForm),r.configId.change(a.updateConfigFields)}d.fn.gravityFormsPayFeedEditor=function(){return this.each(function(){var e,i=d(this);i.data("gf-pay-feed-editor")||(e=new t(this),i.data("gf-pay-feed-editor",e))})},d(document).ready(function(){d(".gforms_edit_form .ideal-edit-link").click(function(e){e.stopPropagation()}),d("#gf-pay-feed-editor").gravityFormsPayFeedEditor(),"undefined"!=typeof gform&&"undefined"!=typeof form&&(gform.addAction("gform_load_field_choices",function(e){var i=e.shift();i&&(e="pronamic_pay_payment_method_selector"===i.type,d('label[for="field_choice_values_enabled"]').parent("div").toggle(!e),e&&d.each(i.choices,function(e,i){i.builtin&&((e=d(".field-choice-input.field-choice-value").eq(e)).attr("disabled","disabled"),e.parent("li").find(".gf_delete_field_choice").remove())}))}),gform.addFilter("gform_has_conditional_logic_dependency",function(e,i){return"undefined"!=typeof form&&-1!==d.inArray(i.toString(),form.pronamic_pay_condition_field_ids)||e})),d(document).on("gform_load_field_settings",function(e,t){d.each({pronamic_pay_config_field:"pronamicPayConfigId",pronamic_pay_display_field:"pronamicPayDisplayMode"},function(e,i){e=d("#"+e);0<e.find('option[value="'+t[i]+'"]').length?e.val(t[i]):SetFieldProperty(i,"")})})})}(jQuery);
//# sourceMappingURL=admin.min.js.map