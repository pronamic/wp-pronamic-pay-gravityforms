!function(c){function t(n){var a=this,o=c(n),r={},s=(r.feed=o.find("#gf_ideal_feed"),r.gravityForm=o.find("#gf_ideal_gravity_form"),r.formId=o.find("#_pronamic_pay_gf_form_id"),r.configId=o.find("#gf_ideal_config_id"),r.delayPostCreationItem=o.find("#gf_ideal_delay_post_creation_item"),r.confirmationSelectFields=o.find(".gf_ideal_confirmation_select"),r.userRoleFieldId=o.find("#gf_ideal_user_role_field_id"),r.delayNotifications=o.find("#gf_ideal_delay_notifications"),r.fieldSelectFields=o.find("select.field-select"),r.subscriptionAmountType=o.find('input[name="_pronamic_pay_gf_subscription_amount_type"]'),r.subscriptionAmountField=o.find("#pronamic_pay_gf_subscription_amount_field"),r.subscriptionIntervalType=o.find('input[name="_pronamic_pay_gf_subscription_interval_type"]'),r.subscriptionInterval=o.find("#pronamic_pay_gf_subscription_interval"),r.subscriptionIntervalPeriod=o.find("#pronamic_pay_gf_subscription_interval_period"),r.subscriptionIntervalDateType=o.find('input[name="_pronamic_pay_gf_subscription_interval_date_type"]'),r.subscriptionIntervalDate=o.find("#pronamic_pay_gf_subscription_interval_date"),r.subscriptionIntervalDateDay=o.find("#pronamic_pay_gf_subscription_interval_date_day"),r.subscriptionIntervalDateMonth=o.find("#pronamic_pay_gf_subscription_interval_date_month"),r.subscriptionIntervalField=o.find("#pronamic_pay_gf_subscription_interval_field"),r.subscriptionFrequencyType=o.find('input[name="_pronamic_pay_gf_subscription_frequency_type"]'),r.subscriptionNumberPeriods=o.find("#pronamic_pay_gf_subscription_number_periods"),r.subscriptionFrequencyField=o.find("#pronamic_pay_gf_subscription_frequency_field"),r.subscriptionTrialEnabled=o.find("#pronamic_pay_gf_subscription_trial_enabled"),r.subscriptionTrialAmountType=o.find("#pronamic_pay_gf_subscription_trial_amount_type"),r.subscriptionTrialAmount=o.find("#pronamic_pay_gf_subscription_trial_amount"),r.subscriptionTrialAmountField=o.find("#pronamic_pay_gf_subscription_trial_amount_field"),JSON.parse(r.feed.val())),p=JSON.parse(r.gravityForm.val());this.updateDelayPostCreationItem=function(){var i=!1;p&&0<a.getFieldsByType(["post_title","post_content","post_excerpt","post_category","post_custom_field","post_image","post_tag"]).length&&(i=!0),r.delayPostCreationItem.toggle(i)},this.updateConfirmationFields=function(){r.confirmationSelectFields.empty(),c("<option>").appendTo(r.confirmationSelectFields),p&&c.each(r.confirmationSelectFields,function(i,n){var a=c(n).attr("data-pronamic-link-name");c.each(p.confirmations,function(i,e){var t=!1;"object"==typeof s.links&&(t=!1,"object"==typeof s.links[a]&&(t=s.links[a].confirmation_id===e.id),c("<option>").attr("value",e.id).text(e.name).prop("selected",t).appendTo(n))})})},this.getFieldsByType=function(i){var e=[];if(p)for(var t=0;t<p.fields.length;t++)0<=c.inArray(p.fields[t].type,i)&&e.push(p.fields[t]);return e},this.getInputs=function(){var t=[];return p&&c.each(p.fields,function(i,e){e.inputs?c.each(e.inputs,function(i,e){t.push(e)}):e.displayOnly||t.push(e)}),t},this.changeForm=function(){jQuery.get(ajaxurl,{action:"gf_get_form_data",formId:r.formId.val()},function(i){i.success&&(p=i.data,a.updateFields())})},this.updateUserRoleFields=function(){r.userRoleFieldId.empty(),c("<option>").appendTo(r.userRoleFieldId),p&&c.each(p.fields,function(i,e){var t=e.adminLabel||e.label;c("<option>").attr("value",e.id).text(t).prop("selected",s.userRoleFieldId==e.id).appendTo(r.userRoleFieldId)})},this.updateConfigFields=function(){var i=r.configId.find("option:selected").attr("data-ideal-method");o.find(".extra-settings").hide(),o.find(".method-"+i).show()},this.updateNotifications=function(){r.delayNotifications.empty(),p&&c.each(p.notifications,function(i,e){var t,n;"form_submission"===e.event&&(t=c("<li>").appendTo(r.delayNotifications),n="pronamic-pay-gf-notification-"+e.id,c('<input type="checkbox" name="_pronamic_pay_gf_delay_notification_ids[]">').attr("id",n).val(e.id).prop("checked",0<=c.inArray(e.id,s.delayNotificationIds)).appendTo(t),t.append(" "),c("<label>").attr("for",n).text(e.name).appendTo(t))})},this.updateSubscriptionFields=function(){var t;p&&(r.subscriptionAmountField.empty(),r.subscriptionIntervalField.empty(),r.subscriptionFrequencyField.empty(),t=[],p&&c.each(p.fields,function(i,e){"product"===e.type&&t.push(e)}),o=c(r.subscriptionAmountField),c("<option>").appendTo(o),c.each(t,function(i,e){var t=e.adminLabel||e.label;c("<option>").attr("value",e.id).text(t).prop("selected",s.subscriptionAmountField==e.id).appendTo(o)}),r.subscriptionAmountType.on("change",function(){var i=r.subscriptionAmountType.filter(":checked").val(),e=(c(n).find(".pronamic-pay-gf-subscription-amount-settings").hide(),""===i?r.subscriptionAmountType.parents("tr").siblings().hide():(r.subscriptionAmountType.parents("tr").siblings().show(),(e=r.subscriptionAmountType.parents("table").find("tr")).removeClass("even"),e.filter(":visible:even").addClass("even")),c(n).find(".pronamic-pay-gf-subscription-amount-settings.amount-"+i));0<e.length&&e.show()}),r.subscriptionAmountType.trigger("change"),o=c(r.subscriptionIntervalField),c("<option>").appendTo(o),c.each(a.getInputs(),function(i,e){var t=e.adminLabel||e.label;c("<option>").attr("value",e.id).text(t).prop("selected",s.subscriptionIntervalField==e.id).appendTo(o)}),r.subscriptionIntervalType.on("change",function(){var i=r.subscriptionIntervalType.filter(":checked").val(),e=(c(n).find(".pronamic-pay-gf-subscription-interval-settings").hide(),c(n).find(".pronamic-pay-gf-subscription-interval-settings.interval-"+i));"fixed"!==i&&(r.subscriptionIntervalPeriod.val("D"),r.subscriptionIntervalPeriod.trigger("change")),0<e.length&&e.show()}),r.subscriptionIntervalDateType.on("change",function(){var i=r.subscriptionIntervalDateType.filter(":checked").val(),i=(c(n).find(".pronamic-pay-gf-subscription-interval-date-settings").hide(),c(n).find(".pronamic-pay-gf-subscription-interval-date-settings.interval-date-"+i));0<i.length&&i.show()}),r.subscriptionIntervalPeriod.on("change",function(){var i=r.subscriptionIntervalPeriod.val();switch(c(n).find(".pronamic-pay-gf-subscription-interval-date-sync-settings").hide(),c(n).find(".pronamic-pay-gf-subscription-interval-date-sync-settings.interval-"+i).show(),i){case"D":r.subscriptionIntervalDateType.filter('[value="payment_date"]').prop("checked",!0),r.subscriptionIntervalDateType.attr("disabled","disabled"),r.subscriptionIntervalDate.val(""),r.subscriptionIntervalDateDay.val(""),r.subscriptionIntervalDateMonth.val("");break;case"W":r.subscriptionIntervalDateType.removeAttr("disabled"),r.subscriptionIntervalDate.val(""),r.subscriptionIntervalDateMonth.val("");break;case"M":r.subscriptionIntervalDateType.removeAttr("disabled"),r.subscriptionIntervalDateDay.val(""),r.subscriptionIntervalDateMonth.val("");break;case"Y":r.subscriptionIntervalDateType.removeAttr("disabled"),r.subscriptionIntervalDateDay.val("")}r.subscriptionIntervalDateType.trigger("change")}),c(n).find("select.pronamic-pay-gf-subscription-interval-date-sync-settings").on("change",function(){r.subscriptionIntervalDateType.filter('[value="sync"]').prop("checked",!0),r.subscriptionIntervalDateType.trigger("change")}),r.subscriptionIntervalType.trigger("change"),r.subscriptionIntervalPeriod.trigger("change"),o=c(r.subscriptionFrequencyField),c("<option>").appendTo(o),c.each(a.getInputs(),function(i,e){var t=e.adminLabel||e.label;c("<option>").attr("value",e.id).text(t).prop("selected",s.subscriptionFrequencyField==e.id).appendTo(o)}),r.subscriptionFrequencyType.on("change",function(){var i=r.subscriptionFrequencyType.filter(":checked").val(),i=(c(n).find(".pronamic-pay-gf-subscription-frequency-settings").hide(),c(n).find(".pronamic-pay-gf-subscription-frequency-settings.frequency-"+i));0<i.length&&i.show()}),r.subscriptionFrequencyType.trigger("change"),r.subscriptionTrialEnabled.on("change",function(){var i=0<r.subscriptionTrialEnabled.filter(":checked").length,e=c(n).find(".pronamic-pay-gf-subscription-trial-settings");i?e.show():e.hide()}),r.subscriptionTrialEnabled.trigger("change"),o=c(r.subscriptionTrialAmountField),c("<option>").appendTo(o),c.each(a.getInputs(),function(i,e){var t=e.adminLabel||e.label;c("<option>").attr("value",e.id).text(t).prop("selected",s.subscriptionTrialAmountField==e.id).appendTo(o)}),r.subscriptionTrialAmountType.on("change",function(){var i=r.subscriptionTrialAmountType.val(),e=c(r.subscriptionTrialAmount),t=c(r.subscriptionTrialAmountField);switch(console.log(i),i){case"free":e.hide(),t.hide();break;case"fixed":e.show(),t.hide();break;case"field":e.hide(),t.show()}}),r.subscriptionTrialAmountType.trigger("change"))},this.updateSelectFields=function(){p&&(r.fieldSelectFields.empty(),r.fieldSelectFields.each(function(i,e){var n=(o=c(e)).data("gateway-field-name"),e=o.data("auto-option-label");""!==e&&c("<option>").attr("value","auto").text(e).prop("selected","auto"==s.fields[n]).appendTo(o),c("<option>").appendTo(o),c.each(a.getInputs(),function(i,e){var t=e.adminLabel||e.label;c("<option>").attr("value",e.id).text(t).prop("selected",s.fields[n]==e.id).appendTo(o)})}))},this.updateFields=function(){a.updateConfigFields(),a.updateDelayPostCreationItem(),a.updateConfirmationFields(),a.updateUserRoleFields(),a.updateSubscriptionFields(),a.updateSelectFields(),a.updateNotifications()},a.updateFields(),r.formId.change(a.changeForm),r.configId.change(a.updateConfigFields)}c.fn.gravityFormsPayFeedEditor=function(){return this.each(function(){var i,e=c(this);e.data("gf-pay-feed-editor")||(i=new t(this),e.data("gf-pay-feed-editor",i))})},c(document).ready(function(){c(".gforms_edit_form .ideal-edit-link").click(function(i){i.stopPropagation()}),c("#gf-pay-feed-editor").gravityFormsPayFeedEditor(),"undefined"!=typeof gform&&"undefined"!=typeof form&&(gform.addAction("gform_load_field_choices",function(i){var e,i=i.shift();i&&(e="pronamic_pay_payment_method_selector"===i.type,c('label[for="field_choice_values_enabled"]').parent("div").toggle(!e),e)&&c.each(i.choices,function(i,e){e.builtin&&((e=c(".field-choice-input.field-choice-value").eq(i)).attr("disabled","disabled"),e.parent("li").find(".gf_delete_field_choice").remove())})}),gform.addFilter("gform_has_conditional_logic_dependency",function(i,e){return"undefined"!=typeof form&&-1!==c.inArray(e.toString(),form.pronamic_pay_condition_field_ids)||i})),c(document).on("gform_load_field_settings",function(i,t){c.each({pronamic_pay_config_field:"pronamicPayConfigId",pronamic_pay_display_field:"pronamicPayDisplayMode"},function(i,e){i=c("#"+i);0<i.find('option[value="'+t[e]+'"]').length?i.val(t[e]):SetFieldProperty(e,"")})})})}(jQuery);
//# sourceMappingURL=admin.min.js.map