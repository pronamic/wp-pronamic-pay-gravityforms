!function(c){function n(t){var a=this,r=c(t),o={},s=(o.feed=r.find("#gf_ideal_feed"),o.gravityForm=r.find("#gf_ideal_gravity_form"),o.configId=r.find("#gf_ideal_config_id"),o.delayNotifications=r.find("#gf_ideal_delay_notifications"),o.fieldSelectFields=r.find("select.field-select"),o.subscriptionAmountType=r.find('input[name="_pronamic_pay_gf_subscription_amount_type"]'),o.subscriptionAmountField=r.find("#pronamic_pay_gf_subscription_amount_field"),o.subscriptionIntervalType=r.find('input[name="_pronamic_pay_gf_subscription_interval_type"]'),o.subscriptionInterval=r.find("#pronamic_pay_gf_subscription_interval"),o.subscriptionIntervalPeriod=r.find("#pronamic_pay_gf_subscription_interval_period"),o.subscriptionIntervalDateType=r.find('input[name="_pronamic_pay_gf_subscription_interval_date_type"]'),o.subscriptionIntervalDate=r.find("#pronamic_pay_gf_subscription_interval_date"),o.subscriptionIntervalDateDay=r.find("#pronamic_pay_gf_subscription_interval_date_day"),o.subscriptionIntervalDateMonth=r.find("#pronamic_pay_gf_subscription_interval_date_month"),o.subscriptionIntervalField=r.find("#pronamic_pay_gf_subscription_interval_field"),o.subscriptionFrequencyType=r.find('input[name="_pronamic_pay_gf_subscription_frequency_type"]'),o.subscriptionNumberPeriods=r.find("#pronamic_pay_gf_subscription_number_periods"),o.subscriptionFrequencyField=r.find("#pronamic_pay_gf_subscription_frequency_field"),o.subscriptionTrialEnabled=r.find("#pronamic_pay_gf_subscription_trial_enabled"),JSON.parse(o.feed.val())),p=JSON.parse(o.gravityForm.val());this.getFieldsByType=function(i){var e=[];if(p)for(var n=0;n<p.fields.length;n++)0<=c.inArray(p.fields[n].type,i)&&e.push(p.fields[n]);return e},this.getInputs=function(){var n=[];return p&&c.each(p.fields,function(i,e){e.inputs?c.each(e.inputs,function(i,e){n.push(e)}):e.displayOnly||n.push(e)}),n},this.updateConfigFields=function(){var i=o.configId.find("option:selected").attr("data-ideal-method");r.find(".extra-settings").hide(),r.find(".method-"+i).show()},this.updateNotifications=function(){o.delayNotifications.empty(),p&&c.each(p.notifications,function(i,e){var n,t;"form_submission"===e.event&&(n=c("<li>").appendTo(o.delayNotifications),t="pronamic-pay-gf-notification-"+e.id,c('<input type="checkbox" name="_pronamic_pay_gf_delay_notification_ids[]">').attr("id",t).val(e.id).prop("checked",0<=c.inArray(e.id,s.delayNotificationIds)).appendTo(n),n.append(" "),c("<label>").attr("for",t).text(e.name).appendTo(n))})},this.updateSubscriptionFields=function(){var n;p&&(o.subscriptionAmountField.empty(),o.subscriptionIntervalField.empty(),o.subscriptionFrequencyField.empty(),n=[],p&&c.each(p.fields,function(i,e){"product"===e.type&&n.push(e)}),r=c(o.subscriptionAmountField),c("<option>").appendTo(r),c.each(n,function(i,e){var n=e.adminLabel||e.label;c("<option>").attr("value",e.id).text(n).prop("selected",s.subscriptionAmountField==e.id).appendTo(r)}),o.subscriptionAmountType.on("change",function(){var i=o.subscriptionAmountType.filter(":checked").val(),e=(c(t).find(".pronamic-pay-gf-subscription-amount-settings").hide(),""===i?o.subscriptionAmountType.parents("tr").siblings().hide():(o.subscriptionAmountType.parents("tr").siblings().show(),(e=o.subscriptionAmountType.parents("table").find("tr")).removeClass("even"),e.filter(":visible:even").addClass("even")),c(t).find(".pronamic-pay-gf-subscription-amount-settings.amount-"+i));0<e.length&&e.show()}),o.subscriptionAmountType.trigger("change"),r=c(o.subscriptionIntervalField),c("<option>").appendTo(r),c.each(a.getInputs(),function(i,e){var n=e.adminLabel||e.label;c("<option>").attr("value",e.id).text(n).prop("selected",s.subscriptionIntervalField==e.id).appendTo(r)}),o.subscriptionIntervalType.on("change",function(){var i=o.subscriptionIntervalType.filter(":checked").val(),e=(c(t).find(".pronamic-pay-gf-subscription-interval-settings").hide(),c(t).find(".pronamic-pay-gf-subscription-interval-settings.interval-"+i));"fixed"!==i&&(o.subscriptionIntervalPeriod.val("D"),o.subscriptionIntervalPeriod.trigger("change")),0<e.length&&e.show()}),o.subscriptionIntervalDateType.on("change",function(){var i=o.subscriptionIntervalDateType.filter(":checked").val(),i=(c(t).find(".pronamic-pay-gf-subscription-interval-date-settings").hide(),c(t).find(".pronamic-pay-gf-subscription-interval-date-settings.interval-date-"+i));0<i.length&&i.show()}),o.subscriptionIntervalPeriod.on("change",function(){var i=o.subscriptionIntervalPeriod.val();switch(c(t).find(".pronamic-pay-gf-subscription-interval-date-sync-settings").hide(),c(t).find(".pronamic-pay-gf-subscription-interval-date-sync-settings.interval-"+i).show(),i){case"D":o.subscriptionIntervalDateType.filter('[value="payment_date"]').prop("checked",!0),o.subscriptionIntervalDateType.attr("disabled","disabled"),o.subscriptionIntervalDate.val(""),o.subscriptionIntervalDateDay.val(""),o.subscriptionIntervalDateMonth.val("");break;case"W":o.subscriptionIntervalDateType.removeAttr("disabled"),o.subscriptionIntervalDate.val(""),o.subscriptionIntervalDateMonth.val("");break;case"M":o.subscriptionIntervalDateType.removeAttr("disabled"),o.subscriptionIntervalDateDay.val(""),o.subscriptionIntervalDateMonth.val("");break;case"Y":o.subscriptionIntervalDateType.removeAttr("disabled"),o.subscriptionIntervalDateDay.val("")}o.subscriptionIntervalDateType.trigger("change")}),c(t).find("select.pronamic-pay-gf-subscription-interval-date-sync-settings").on("change",function(){o.subscriptionIntervalDateType.filter('[value="sync"]').prop("checked",!0),o.subscriptionIntervalDateType.trigger("change")}),o.subscriptionIntervalType.trigger("change"),o.subscriptionIntervalPeriod.trigger("change"),r=c(o.subscriptionFrequencyField),c("<option>").appendTo(r),c.each(a.getInputs(),function(i,e){var n=e.adminLabel||e.label;c("<option>").attr("value",e.id).text(n).prop("selected",s.subscriptionFrequencyField==e.id).appendTo(r)}),o.subscriptionFrequencyType.on("change",function(){var i=o.subscriptionFrequencyType.filter(":checked").val(),i=(c(t).find(".pronamic-pay-gf-subscription-frequency-settings").hide(),c(t).find(".pronamic-pay-gf-subscription-frequency-settings.frequency-"+i));0<i.length&&i.show()}),o.subscriptionFrequencyType.trigger("change"),o.subscriptionTrialEnabled.on("change",function(){var i=0<o.subscriptionTrialEnabled.filter(":checked").length,e=c(t).find(".pronamic-pay-gf-subscription-trial-settings");i?e.show():e.hide()}),o.subscriptionTrialEnabled.trigger("change"))},this.updateSelectFields=function(){p&&(o.fieldSelectFields.empty(),o.fieldSelectFields.each(function(i,e){var t=(r=c(e)).data("gateway-field-name"),e=r.data("auto-option-label");""!==e&&c("<option>").attr("value","auto").text(e).prop("selected","auto"==s.fields[t]).appendTo(r),c("<option>").appendTo(r),c.each(a.getInputs(),function(i,e){var n=e.adminLabel||e.label;c("<option>").attr("value",e.id).text(n).prop("selected",s.fields[t]==e.id).appendTo(r)})}))},this.updateFields=function(){a.updateConfigFields(),a.updateSubscriptionFields(),a.updateSelectFields(),a.updateNotifications()},a.updateFields(),o.configId.change(a.updateConfigFields)}c.fn.gravityFormsPayFeedEditor=function(){return this.each(function(){var i,e=c(this);e.data("gf-pay-feed-editor")||(i=new n(this),e.data("gf-pay-feed-editor",i))})},c(document).ready(function(){c(".gforms_edit_form .ideal-edit-link").click(function(i){i.stopPropagation()}),c("#gf-pay-feed-editor").gravityFormsPayFeedEditor(),"undefined"!=typeof gform&&"undefined"!=typeof form&&(gform.addAction("gform_load_field_choices",function(i){var e,i=i.shift();i&&(e="pronamic_pay_payment_method_selector"===i.type,c('label[for="field_choice_values_enabled"]').parent("div").toggle(!e),e&&c.each(i.choices,function(i,e){e.builtin&&((e=c(".field-choice-input.field-choice-value").eq(i)).attr("disabled","disabled"),e.parent("li").find(".gf_delete_field_choice").remove())}))}),gform.addFilter("gform_has_conditional_logic_dependency",function(i,e){return"undefined"!=typeof form&&-1!==c.inArray(e.toString(),form.pronamic_pay_condition_field_ids)||i})),c(document).on("gform_load_field_settings",function(i,n){c.each({pronamic_pay_config_field:"pronamicPayConfigId",pronamic_pay_display_field:"pronamicPayDisplayMode"},function(i,e){i=c("#"+i);0<i.find('option[value="'+n[e]+'"]').length?i.val(n[e]):SetFieldProperty(e,"")})})})}(jQuery);
//# sourceMappingURL=admin.min.js.map